# Conda Environment Manager Usage

The GDash django codebase runs inside of an isolated virtual environment to ensure reproducibility. While a variety of environment and package managers are available, this document details the use of miniconda.


## Anaconda, Miniconda and Virtualenv

If you have used pip and virtualenv in the past, you can use conda to perform all of the same operations. Pip is a package manager, and virtualenv is an environment manager; and conda is both.

Specifically, conda is a packaging tool and installer that aims to do more than what pip does; it handles library dependencies outside of the Python packages as well as the Python packages themselves. Conda also creates a virtual environment, like virtualenv does.

Both Anaconda and Miniconda uses Conda as the package manager. The difference among Anaconda and Miniconda is that Miniconda only comes the package management system. So when you install it, there is just the management system and not coming with a bundle of pre-installed packages like Anaconda does. Once Conda is installed, you can then install whatever package you need from scratch along with any desired version of Python.

**Choose Anaconda if you:**

- Are new to conda or Python
- Prefer having Python and 720+ open source certified packages automatically installed at once
- Have the time and disk space (a few minutes and 3 GB)
- Donâ€™t want to install each of the packages you want to use individually

**Choose Miniconda if you:**

- Know what package(s) you need to install
- Do not have time or disk space (about 3 GB) to install over 720+ packages (packages can be installed when needed)
- Just want fast access to Python and the conda commands, and prefer to sorting out the other packages later

_Choose Virtualenv only when you have sudo access to the machine you are working on._ It is much easier to setup conda rather than virtualenv for a regular (i.e., non sudo/root) user on a linux/Mac machine.


## Conda Virtual Environment Setup

Prerequisite: Install Miniconda: [Conda Installation Process](https://conda.io/projects/conda/en/latest/user-guide/install/index.html)


### From the cli

Note: The CLI based approach is currently recommended due to bugs in the way conda operates across disparate architectures and distribution platforms.

1. In a terminal, verify that you have conda succesfully installed under your account: `conda -V`
2. Create a new virtual environment for running the gdash webapp: `conda create -yn gdash-py2 python=2.7.15 nodejs=8.12.0 --channel conda-forge`


### Using an environment.yml file

Note: This approach does not seem to consistently work across disparate architectures and distribution platforms (e.g. - OSX to CentOS). I will try and update this once a solution here is found, but recommend using the CLI approach for now.

1. In a terminal, navigate to the `gdash/venv` folder inside the root gdash folder: `cd venv`
2. Create the virtual environment from the `venv/environment.yml` file: `conda env create -f environment.yml`
    - NOTE: The environment will be created in the default conda environment path (usually the `$HOME` or `%USERPROFILE%` location).
    - This location can be overridden by specifying the path as follows: `conda env create -f venv/environment.yml -p /PATH/TO/VIRTUAL/ENVIRONMENT/DIRECTORY/gdash-py2`


### Using the Virtual Environment

1. Verify the environment was created (named gdash-py2): `conda env list`
2. Activate the new environment: `conda activate gdash-py2` or `source activate gdash-py2`
3. Verify that the new environment was installed correctly: `conda list`
4. To examine the environment details: `conda info`


### Deactivating or Removing the Virtual Environment

To deactivate the environment when you are not in active development: `conda deactivate` or `source deactivate`

To remove the virtual environment, should you need to remove or recreate it: `conda remove --name gdash-py2 --all`


## Vendor Resources

[Anaconda Website](https://www.anaconda.com/)

[Miniconda Documentation](https://docs.conda.io/en/latest/miniconda.html)

[Conda Documentation](https://conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html?highlight=environment#sharing-an-environment)


## Notes on Environments

If a new dependency is added to the project, a new environment file will need to be generated to capture the added dependency.

In order to generate a new environment.yml file, issue the following command from inside the `gdash/venv` folder while the environment is active:
`conda env export | grep -v "^prefix: " > environment.yml`

- The `| grep -v "^prefix: " >` portion trims off a `prefix` key that gets autogenerated in the environment file and is specific to the OS and user being used. Inclusion of this key will cause problem when recreating the environment on a different OS type.
